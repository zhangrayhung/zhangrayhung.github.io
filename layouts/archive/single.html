{{ define "main" }}
<article class="post">
  <header class="post-header"><h1 class="post-title">{{ .Title }}</h1></header>

  <div class="post-content">
    {{ $currentYear := now.Format "2006" }}
    {{ range (.Site.RegularPages.ByDate.Reverse.GroupByDate "2006") }}
      {{ if eq .Key "0001" }}{{ continue }}{{ end }}
      {{ $isCurrentYear := eq .Key $currentYear }}
      <section class="archive-year">
        <h2 class="year-title {{ if $isCurrentYear }}open{{ end }}">
          {{ .Key }} <span class="toggle">â–¶</span>
        </h2>
        <div class="year-body">
          {{ range (.Pages.GroupByDate "January") }}
            <h3 class="month-title">{{ .Key }}</h3>
            <ul class="post-list">
              {{ range .Pages }}
                <li class="post-item">
                  <time class="post-date">{{ .Date.Format "Jan 2" }}</time>
                  <a class="post-title" href="{{ .RelPermalink }}">{{ .Title }}</a>
                </li>
              {{ end }}
            </ul>
          {{ end }}
        </div>
      </section>
    {{ end }}
  </div>
</article>

<script>
/* fold/unfold */
document.querySelectorAll('.year-title').forEach(head => {
  const arrow = head.querySelector('.toggle');
  const body  = head.nextElementSibling;

  function updateViewState() {
    if (head.classList.contains('open')) {
      body.style.display = 'block';
      arrow.style.transform = 'rotate(90deg)';
    } else {
      body.style.display = 'none';
      arrow.style.transform = 'rotate(0deg)';
    }
  }

  // Set initial state
  updateViewState();

  head.addEventListener('click', () => {
    head.classList.toggle('open');
    updateViewState();
  });
});
</script>
{{ end }}